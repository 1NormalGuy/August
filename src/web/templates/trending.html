<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><path d=%22M50 15 L85 85 L15 85 Z%22 fill=%22none%22 stroke=%22%23d1d5db%22 stroke-width=%228%22 stroke-linejoin=%22round%22/></svg>" />
  <style>
    :root {
      --bg-body: #050505;
      --card-bg: rgba(20, 20, 20, 0.4);
      --card-bg-hover: rgba(30, 30, 30, 0.9);
      --card-border: rgba(255, 255, 255, 0.08);
      --text-main: #ececec;
      --text-muted: #666;
      --accent: #d4b06c;
      --accent-green: #00ff9d;
      --accent-red: #ff6b6b;
      --accent-blue: #6ba3ff;
      --accent-purple: #a36bff;
      --font-display: "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
      --font-mono: "SF Mono", "Menlo", monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      outline: none;
    }

    body {
      background-color: var(--bg-body);
      color: var(--text-main);
      font-family: var(--font-display);
      min-height: 100vh;
      overflow-x: hidden;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
    }

    body::before {
      content: '';
      position: fixed;
      top: -20%;
      left: 50%;
      transform: translateX(-50%);
      width: 80vw;
      height: 600px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.03) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* æ‚¬æµ®å¯¼èˆªå²› */
    nav.floating-island {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      background: rgba(15, 15, 15, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 8px 16px;
      border-radius: 100px;
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      align-items: center;
      gap: 12px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      transition: transform 0.2s ease, border-color 0.2s ease;
      max-width: calc(100vw - 40px);
      white-space: nowrap;
    }

    nav.floating-island:hover {
      transform: translateX(-50%) scale(1.01);
      border-color: rgba(255, 255, 255, 0.3);
    }

    /* å“åº”å¼ï¼šå°å±å¹•æ—¶éšè—éƒ¨åˆ†å…ƒç´  */
    @media (max-width: 900px) {
      nav.floating-island {
        padding: 6px 12px;
        gap: 8px;
      }
      .refresh-control {
        display: none;
      }
      .nav-divider:nth-of-type(3) {
        display: none;
      }
    }

    @media (max-width: 600px) {
      nav.floating-island {
        padding: 6px 10px;
        gap: 6px;
        bottom: 20px;
      }
      .nav-logo span {
        display: none;
      }
      .tab-pill {
        padding: 6px 12px;
        font-size: 0.8rem;
      }
    }

    .nav-logo {
      font-weight: 700;
      font-size: 0.95rem;
      letter-spacing: 0.05em;
      color: #fff;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-right: 4px;
    }

    .nav-divider {
      width: 1px;
      height: 16px;
      background: rgba(255,255,255,0.1);
    }

    .nav-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .nav-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: transparent;
      cursor: pointer;
      color: #888;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.15s, color 0.15s;
    }

    .nav-btn:hover {
      background: rgba(255,255,255,0.08);
      color: #fff;
    }

    /* Tab Pills */
    .tab-pills {
      display: flex;
      gap: 6px;
      padding: 4px;
      background: rgba(255,255,255,0.03);
      border-radius: 50px;
    }

    .tab-pill {
      padding: 8px 18px;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 500;
      color: #888;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      background: transparent;
    }

    .tab-pill:hover {
      color: #ccc;
    }

    .tab-pill.active {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }

    /* åˆ·æ–°æ§åˆ¶ - ä¼˜é›…çš„èƒ¶å›Šè®¾è®¡ */
    .refresh-control {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 50px;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .refresh-control .icon {
      width: 14px;
      height: 14px;
      color: #666;
    }

    .refresh-pills {
      display: flex;
      gap: 4px;
    }

    .refresh-pill {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 500;
      color: #666;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      background: transparent;
      font-family: var(--font-mono);
    }

    .refresh-pill:hover {
      color: #999;
      background: rgba(255,255,255,0.05);
    }

    .refresh-pill.active {
      background: var(--accent);
      color: #000;
    }

    .countdown-badge {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--accent);
      padding: 3px 8px;
      background: rgba(212, 176, 108, 0.1);
      border-radius: 12px;
      min-width: 45px;
      text-align: center;
    }

    /* Date Picker */
    .date-trigger {
      position: relative;
    }

    .date-trigger input[type="date"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    /* Main Content */
    main {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 80px 40px 120px;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    /* Hero Typography */
    .hero-section {
      margin-bottom: 60px;
      position: relative;
    }

    .big-date {
      font-size: clamp(3rem, 8vw, 8rem);
      font-weight: 800;
      line-height: 0.9;
      letter-spacing: -0.04em;
      background: linear-gradient(180deg, #fff 0%, #555 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      opacity: 0.95;
      margin-bottom: 24px;
    }

    .hero-meta {
      display: flex;
      align-items: center;
      gap: 32px;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--text-muted);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .meta-dot {
      width: 6px;
      height: 6px;
      background: var(--accent-green);
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(0, 255, 157, 0.4);
    }

    .meta-dot.paused {
      background: var(--accent-red);
      box-shadow: 0 0 8px rgba(255, 107, 107, 0.4);
    }

    /* Masonry Layout */
    .masonry-container {
      column-count: 3;
      column-gap: 32px;
    }

    @media (max-width: 1100px) {
      .masonry-container { column-count: 2; }
    }
    @media (max-width: 700px) {
      .masonry-container { column-count: 1; }
      main { padding: 40px 20px; }
    }

    /* Card Styling */
    .source-card {
      break-inside: avoid;
      margin-bottom: 32px;
      background: rgba(20, 20, 20, 0.2);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 24px;
      position: relative;
      transition: transform 0.15s ease-out, background-color 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
      overflow: hidden;
    }

    .source-card:hover {
      background-color: var(--card-bg-hover);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      z-index: 10;
    }

    .source-header {
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .source-name {
      font-size: 0.75rem;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .items-list {
      display: flex;
      flex-direction: column;
      gap: 0;
      max-height: 400px;
      overflow-y: auto;
    }

    .item {
      display: flex;
      gap: 14px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      text-decoration: none;
      color: var(--text-main);
      transition: opacity 0.15s;
    }

    .item:last-child { border-bottom: none; }
    .item:hover { opacity: 0.7; }

    .item-rank {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: #444;
      min-width: 20px;
      padding-top: 2px;
    }

    .item-title {
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* Summary Section */
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .summary-header h2 {
      font-size: 1.5rem;
      font-weight: 300;
    }

    .summary-pagination {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .page-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 500;
      color: #888;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(255,255,255,0.1);
      background: transparent;
    }

    .page-btn:hover:not(:disabled) {
      color: #fff;
      border-color: rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.05);
    }

    .page-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .page-info {
      font-size: 0.8rem;
      color: #666;
      padding: 0 12px;
      font-family: var(--font-mono);
    }

    .summary-list {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .summary-item {
      padding: 24px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .summary-item:last-child {
      border-bottom: none;
    }

    .summary-item-meta {
      color: var(--accent);
      font-size: 0.8rem;
      margin-bottom: 8px;
      font-family: var(--font-mono);
      letter-spacing: 0.05em;
    }

    .summary-item-title {
      color: #fff;
      text-decoration: none;
      font-size: 1.1rem;
      display: block;
      margin-bottom: 12px;
      font-weight: 600;
      line-height: 1.4;
      transition: color 0.2s;
    }

    .summary-item-title:hover {
      color: var(--accent);
    }

    .summary-item-content {
      color: #888;
      font-size: 0.95rem;
      line-height: 1.8;
    }

    /* ==================== Analytics Section ==================== */
    .analytics-section {
      margin-bottom: 40px;
    }

    .analytics-header {
      margin-bottom: 30px;
    }

    .analytics-header h2 {
      font-size: 1.5rem;
      font-weight: 300;
      margin-bottom: 8px;
    }

    .analytics-header p {
      color: #666;
      font-size: 0.9rem;
    }

    /* Analytics Loading */
    .analytics-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      color: #666;
    }

    .analytics-loading .spinner {
      width: 40px;
      height: 40px;
      border: 2px solid rgba(255,255,255,0.1);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Analytics Grid - 2x2 å¸ƒå±€ */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .analytics-grid {
        grid-template-columns: 1fr;
      }
    }

    .analytics-card {
      background: rgba(20, 20, 20, 0.3);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 24px;
      min-height: 300px;
    }

    .analytics-card.full-width {
      grid-column: 1 / -1;
    }

    .analytics-card h3 {
      font-size: 0.85rem;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .analytics-card h3 .icon {
      font-size: 1.1rem;
    }

    /* äº‹ä»¶èšç±»å¡ç‰‡ */
    .cluster-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .cluster-item {
      padding: 16px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 12px;
      transition: all 0.2s ease;
    }

    .cluster-item:hover {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.1);
    }

    .cluster-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .cluster-theme {
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      line-height: 1.4;
    }

    .cluster-badge {
      font-size: 0.65rem;
      padding: 3px 8px;
      border-radius: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
    }

    .cluster-badge.high {
      background: rgba(255, 107, 107, 0.15);
      color: var(--accent-red);
    }

    .cluster-badge.medium {
      background: rgba(212, 176, 108, 0.15);
      color: var(--accent);
    }

    .cluster-badge.low {
      background: rgba(107, 163, 255, 0.15);
      color: var(--accent-blue);
    }

    .cluster-desc {
      font-size: 0.85rem;
      color: #888;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .cluster-news {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .cluster-news-tag {
      font-size: 0.7rem;
      padding: 4px 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      color: #666;
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* è¶‹åŠ¿æ£€æµ‹ */
    .trend-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .trend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: rgba(255,255,255,0.02);
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .trend-item:hover {
      background: rgba(255,255,255,0.04);
    }

    .trend-keyword {
      font-weight: 600;
      color: #fff;
      min-width: 80px;
    }

    .trend-bar-wrap {
      flex: 1;
      height: 6px;
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
      overflow: hidden;
    }

    .trend-bar-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    .trend-bar-fill.rising {
      background: linear-gradient(90deg, var(--accent-green), #7dffbe);
    }

    .trend-bar-fill.stable {
      background: linear-gradient(90deg, var(--accent), #e8c88a);
    }

    .trend-bar-fill.falling {
      background: linear-gradient(90deg, var(--accent-red), #ff9d9d);
    }

    .trend-meta {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .trend-heat {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: #666;
      min-width: 35px;
      text-align: right;
    }

    .trend-type {
      font-size: 0.6rem;
      padding: 2px 6px;
      border-radius: 8px;
      text-transform: uppercase;
      font-weight: 600;
    }

    .trend-type.breaking {
      background: rgba(255, 107, 107, 0.15);
      color: var(--accent-red);
    }

    .trend-type.ongoing {
      background: rgba(212, 176, 108, 0.15);
      color: var(--accent);
    }

    .trend-type.emerging {
      background: rgba(107, 163, 255, 0.15);
      color: var(--accent-blue);
    }

    /* å®ä½“æŠ½å– */
    .entity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
    }

    .entity-item {
      padding: 12px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 10px;
      text-align: center;
      transition: all 0.2s ease;
    }

    .entity-item:hover {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.1);
      transform: translateY(-2px);
    }

    .entity-name {
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }

    .entity-type {
      font-size: 0.65rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 6px;
    }

    .entity-mentions {
      font-size: 0.7rem;
      color: var(--accent);
      font-family: var(--font-mono);
    }

    /* æ—¶é—´çº¿ */
    .timeline-list {
      position: relative;
      padding-left: 24px;
    }

    .timeline-list::before {
      content: '';
      position: absolute;
      left: 6px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom, var(--accent), transparent);
    }

    .timeline-item {
      position: relative;
      padding: 12px 0 12px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }

    .timeline-item:last-child {
      border-bottom: none;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -20px;
      top: 18px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--bg-body);
      border: 2px solid var(--accent);
    }

    .timeline-item.high::before {
      border-color: var(--accent-red);
      box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
    }

    .timeline-event {
      font-size: 0.9rem;
      color: #fff;
      margin-bottom: 6px;
      line-height: 1.5;
    }

    .timeline-entities {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .timeline-entity {
      font-size: 0.7rem;
      padding: 3px 8px;
      background: rgba(163, 107, 255, 0.1);
      color: var(--accent-purple);
      border-radius: 10px;
    }

    /* æ¥æºåˆ†å¸ƒ */
    .source-stats-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .source-stat-item {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .source-stat-rank {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: #444;
      min-width: 20px;
    }

    .source-stat-name {
      font-size: 0.85rem;
      color: #ccc;
      min-width: 100px;
    }

    .source-stat-bar {
      flex: 1;
      height: 6px;
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
      overflow: hidden;
    }

    .source-stat-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #e8c88a);
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    .source-stat-count {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: #666;
      min-width: 30px;
      text-align: right;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      z-index: 300;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .circular-progress {
      width: 100px;
      height: 100px;
      position: relative;
    }

    .circular-progress svg {
      transform: rotate(-90deg);
    }

    .circular-progress circle {
      fill: none;
      stroke-width: 4;
      stroke-linecap: round;
    }

    .circular-progress .bg {
      stroke: rgba(255, 255, 255, 0.1);
    }

    .circular-progress .progress {
      stroke: var(--accent);
      stroke-dasharray: 282.6;
      stroke-dashoffset: 282.6;
      transition: stroke-dashoffset 0.3s ease;
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      font-family: var(--font-mono);
    }

    .loading-message {
      margin-top: 24px;
      color: #999;
      font-size: 0.9rem;
    }

    .loading-cancel {
      margin-top: 20px;
      padding: 10px 24px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: #888;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .loading-cancel:hover {
      border-color: rgba(255,255,255,0.4);
      color: #fff;
      background: rgba(255,255,255,0.1);
    }

    /* No Data */
    .no-data {
      color: #666;
      text-align: center;
      padding: 40px 20px;
      font-size: 0.9rem;
    }

    /* Animation */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .source-card, .summary-item, .analytics-card {
      animation: fadeInUp 0.5s ease-out forwards;
      opacity: 0;
    }

    .source-card:nth-child(1), .summary-item:nth-child(1) { animation-delay: 0.05s; }
    .source-card:nth-child(2), .summary-item:nth-child(2) { animation-delay: 0.1s; }
    .source-card:nth-child(3), .summary-item:nth-child(3) { animation-delay: 0.15s; }
    .source-card:nth-child(4), .summary-item:nth-child(4) { animation-delay: 0.2s; }
    .source-card:nth-child(5), .summary-item:nth-child(5) { animation-delay: 0.25s; }
    .source-card:nth-child(6), .summary-item:nth-child(6) { animation-delay: 0.3s; }

    .analytics-card:nth-child(1) { animation-delay: 0.1s; }
    .analytics-card:nth-child(2) { animation-delay: 0.15s; }
    .analytics-card:nth-child(3) { animation-delay: 0.2s; }
    .analytics-card:nth-child(4) { animation-delay: 0.25s; }
  </style>
</head>

<body>
  <nav class="floating-island">
    <a href="/" class="nav-logo">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round">
        <path d="M12 2L2 22h20L12 2z"/>
      </svg>
      August
    </a>
    <div class="nav-divider"></div>
    
    <!-- Tab Pills -->
    <div class="tab-pills">
      <button class="tab-pill active" data-tab="trending">çƒ­æœ</button>
      <button class="tab-pill" data-tab="summary">æ‘˜è¦</button>
      <button class="tab-pill" data-tab="analytics">åˆ†æ</button>
    </div>
    
    <div class="nav-divider"></div>
    
    <!-- Refresh Control - ä¼˜é›…çš„èƒ¶å›Šè®¾è®¡ -->
    <div class="refresh-control">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M23 4v6h-6M1 20v-6h6"/>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
      </svg>
      <div class="refresh-pills">
        <button class="refresh-pill" data-minutes="0">å…³</button>
        <button class="refresh-pill" data-minutes="5">5m</button>
        <button class="refresh-pill" data-minutes="15">15m</button>
        <button class="refresh-pill active" data-minutes="30">30m</button>
        <button class="refresh-pill" data-minutes="60">1h</button>
      </div>
      <div class="countdown-badge" id="countdown">--:--</div>
    </div>
    
    <div class="nav-divider"></div>
    <div class="nav-actions">
      <form class="date-trigger" action="" method="get" title="é€‰æ‹©æ—¥æœŸ">
        <input type="date" id="date-input" name="date" />
        <button type="button" class="nav-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
        </button>
      </form>
      <button class="nav-btn refresh-trigger" title="ç«‹å³åˆ·æ–°">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
      </button>
    </div>
  </nav>

  <main>
    <div class="hero-section">
      <div class="big-date" id="display-date">TODAY</div>
      <div class="hero-meta">
        <div class="meta-item">
          <div class="meta-dot" id="live-dot"></div>
          <span id="live-status">Live Feed</span>
        </div>
        <div class="meta-item">
           <span id="source-count">0</span> Sources
        </div>
        <div class="meta-item">
           <span id="item-count">0</span> Insights
        </div>
      </div>
    </div>

    <!-- çƒ­æœæ¿å— -->
    <div class="content-section active" id="section-trending">
      <div class="masonry-container" id="sources-grid"></div>
    </div>

    <!-- æ‘˜è¦æ¿å— -->
    <div class="content-section" id="section-summary">
      <div class="summary-header">
        <h2>Daily Insights</h2>
        <div class="summary-pagination">
          <button class="page-btn" id="prev-page" disabled>â† ä¸Šä¸€é¡µ</button>
          <span class="page-info" id="page-info">1 / 1</span>
          <button class="page-btn" id="next-page">ä¸‹ä¸€é¡µ â†’</button>
        </div>
      </div>
      <div class="summary-list" id="summary-list">
        <div class="no-data">ç‚¹å‡»æ­¤æ ‡ç­¾é¡µå¼€å§‹ç”Ÿæˆæ‘˜è¦...</div>
      </div>
    </div>

    <!-- åˆ†ææ¿å— -->
    <div class="content-section" id="section-analytics">
      <div class="analytics-header">
        <h2>Intelligence Analysis</h2>
        <p>AI é©±åŠ¨çš„æ–°é—»æ™ºèƒ½åˆ†æ Â· äº‹ä»¶èšç±» Â· è¶‹åŠ¿æ£€æµ‹ Â· å®ä½“æŠ½å–</p>
      </div>
      
      <div id="analytics-content">
        <div class="analytics-loading">
          <div class="spinner"></div>
          <p>ç‚¹å‡»æ­¤æ ‡ç­¾é¡µå¼€å§‹åˆ†æ...</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="circular-progress">
      <svg width="100" height="100">
        <circle class="bg" cx="50" cy="50" r="45"></circle>
        <circle class="progress" id="progress-circle" cx="50" cy="50" r="45"></circle>
      </svg>
      <div class="progress-text" id="progress-text">0%</div>
    </div>
    <div class="loading-message" id="loading-message">æ­£åœ¨ç”Ÿæˆæ‘˜è¦...</div>
    <button class="loading-cancel" id="loading-cancel">å–æ¶ˆ</button>
  </div>

  <template id="source-card-template">
    <div class="source-card">
      <div class="source-header">
        <div class="source-name"></div>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
      </div>
      <div class="items-list"></div>
    </div>
  </template>

  <template id="source-item-template">
    <a class="item" target="_blank" rel="noopener noreferrer">
      <div class="item-rank"></div>
      <div class="item-content">
        <div class="item-title"></div>
      </div>
    </a>
  </template>

  <template id="summary-item-template">
    <div class="summary-item">
      <div class="summary-item-meta"></div>
      <a class="summary-item-title" target="_blank" rel="noopener noreferrer"></a>
      <p class="summary-item-content"></p>
    </div>
  </template>

  <script>
    const data = __DATA_PLACEHOLDER__;
    
    // å…¨å±€çŠ¶æ€
    let currentTab = 'trending';
    let allNewsFlat = [];
    let summaryCache = {};
    let currentPage = 1;
    const PAGE_SIZE = 10;
    let currentAnchor = null;
    let abortController = null;
    let progressInterval = null;
    let countdownTimer = null;
    let countdownSeconds = 0;
    let analyticsLoaded = false;
    let analyticsData = null;

    function formatBigDate(dateStr) {
      if(!dateStr) return "TODAY";
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).toUpperCase();
    }

    function sanitizeTitle(title) {
      const div = document.createElement("div");
      div.textContent = title;
      return div.innerHTML;
    }

    // ==================== åˆ·æ–°æ§åˆ¶ ====================
    function setupRefreshControl() {
      const pills = document.querySelectorAll('.refresh-pill');
      const savedMinutes = localStorage.getItem('augustRefreshMinutes') || '30';
      
      pills.forEach(pill => {
        if (pill.dataset.minutes === savedMinutes) {
          pill.classList.add('active');
        } else {
          pill.classList.remove('active');
        }
        
        pill.addEventListener('click', () => {
          pills.forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          const minutes = parseInt(pill.dataset.minutes);
          localStorage.setItem('augustRefreshMinutes', pill.dataset.minutes);
          startCountdown(minutes);
        });
      });
      
      startCountdown(parseInt(savedMinutes));
    }

    function startCountdown(minutes) {
      if (countdownTimer) clearInterval(countdownTimer);
      
      const liveDot = document.getElementById('live-dot');
      const liveStatus = document.getElementById('live-status');
      const countdownEl = document.getElementById('countdown');
      
      if (minutes === 0) {
        liveDot.classList.add('paused');
        liveStatus.textContent = 'Paused';
        countdownEl.textContent = '--:--';
        return;
      }
      
      liveDot.classList.remove('paused');
      liveStatus.textContent = 'Live Feed';
      countdownSeconds = minutes * 60;
      
      function tick() {
        const mins = Math.floor(countdownSeconds / 60);
        const secs = countdownSeconds % 60;
        countdownEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        
        if (countdownSeconds <= 0) {
          window.location.reload();
        }
        countdownSeconds--;
      }
      
      tick();
      countdownTimer = setInterval(tick, 1000);
    }

    // ==================== Loading Overlay ====================
    function showLoading(message = "å¤„ç†ä¸­...") {
      document.getElementById('loading-overlay').classList.add('active');
      document.getElementById('loading-message').textContent = message;
      resetProgress();
    }

    function hideLoading() {
      document.getElementById('loading-overlay').classList.remove('active');
      if (progressInterval) {
        clearInterval(progressInterval);
        progressInterval = null;
      }
    }

    let currentProgress = 0;
    function setProgress(percent) {
      if (percent < currentProgress && percent !== 0) return;
      currentProgress = percent;
      
      const circle = document.getElementById('progress-circle');
      const text = document.getElementById('progress-text');
      const circumference = 2 * Math.PI * 45;
      const offset = circumference - (percent / 100) * circumference;
      circle.style.strokeDashoffset = offset;
      text.textContent = Math.round(percent) + '%';
    }

    function resetProgress() {
      currentProgress = 0;
      setProgress(0);
    }

    function cancelLoading() {
      if (abortController) {
        abortController.abort();
        abortController = null;
      }
      hideLoading();
      resetProgress();
    }

    document.getElementById('loading-cancel').addEventListener('click', cancelLoading);

    // ==================== æ•°æ®å¤„ç† ====================
    function flattenNews() {
      allNewsFlat = [];
      if (data.sources) {
        data.sources.forEach(source => {
          source.items.forEach(item => {
            allNewsFlat.push({
              title: item.title,
              url: item.link,
              source_name: source.name,
              rank: item.rank
            });
          });
        });
      }
    }

    // ==================== æ‘˜è¦ç”Ÿæˆ ====================
    async function generateSummaries(page) {
      if (summaryCache[page]) {
        renderSummaries(summaryCache[page], page);
        return;
      }

      showLoading(`æ­£åœ¨ç”Ÿæˆç¬¬ ${page} é¡µæ‘˜è¦...`);
      abortController = new AbortController();

      try {
        let estimatedProgress = 0;
        progressInterval = setInterval(() => {
          if (estimatedProgress < 95) {
            estimatedProgress = Math.min(estimatedProgress + 2 + Math.random() * 2, 95);
            setProgress(estimatedProgress);
          }
        }, 1000);

        const response = await fetch('/api/summary/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            news_list: allNewsFlat,
            page: page,
            page_size: PAGE_SIZE
          }),
          signal: abortController.signal
        });

        const result = await response.json();
        
        clearInterval(progressInterval);
        progressInterval = null;
        setProgress(100);
        
        if (result.anchor) currentAnchor = result.anchor;

        if (result.success) {
          summaryCache[page] = result;
          setTimeout(() => {
            hideLoading();
            resetProgress();
            renderSummaries(result, page);
          }, 300);
        } else {
          hideLoading();
          resetProgress();
          alert('ç”Ÿæˆæ‘˜è¦å¤±è´¥');
        }
      } catch (error) {
        clearInterval(progressInterval);
        if (error.name !== 'AbortError') {
          hideLoading();
          resetProgress();
          console.error('ç”Ÿæˆæ‘˜è¦å¤±è´¥:', error);
        }
      }
    }

    function renderSummaries(result, page) {
      const container = document.getElementById('summary-list');
      const totalPages = Math.ceil(result.total / PAGE_SIZE);
      
      document.getElementById('page-info').textContent = `${page} / ${totalPages}`;
      document.getElementById('prev-page').disabled = page <= 1;
      document.getElementById('next-page').disabled = !result.has_more;

      if (!result.summaries || result.summaries.length === 0) {
        container.innerHTML = '<div class="no-data">æš‚æ— æ‘˜è¦æ•°æ®</div>';
        return;
      }

      const template = document.getElementById('summary-item-template');
      container.innerHTML = '';

      result.summaries.forEach((item, i) => {
        const num = ((page - 1) * PAGE_SIZE + i + 1).toString().padStart(2, '0');
        const fragment = template.content.cloneNode(true);
        
        fragment.querySelector('.summary-item-meta').textContent = `${num} // ${item.source_name}`;
        
        const titleEl = fragment.querySelector('.summary-item-title');
        titleEl.href = item.url;
        titleEl.textContent = item.title;
        
        fragment.querySelector('.summary-item-content').textContent = item.summary || 'æ‘˜è¦ç”Ÿæˆä¸­...';
        
        container.appendChild(fragment);
      });
    }

    // ==================== åˆ†ææ¨¡å— ====================
    async function loadAnalytics() {
      if (analyticsLoaded && analyticsData) {
        renderAnalytics(analyticsData);
        return;
      }

      const container = document.getElementById('analytics-content');
      container.innerHTML = `
        <div class="analytics-loading">
          <div class="spinner"></div>
          <p>AI æ­£åœ¨åˆ†ææ–°é—»æ•°æ®...</p>
        </div>
      `;

      try {
        const response = await fetch('/api/analytics/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ news_list: allNewsFlat })
        });

        const result = await response.json();
        
        if (result.success) {
          analyticsLoaded = true;
          analyticsData = result;
          renderAnalytics(result);
        } else {
          container.innerHTML = '<div class="no-data">åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
        }
      } catch (error) {
        console.error('åˆ†æå¤±è´¥:', error);
        container.innerHTML = '<div class="no-data">åˆ†æå¤±è´¥: ' + error.message + '</div>';
      }
    }

    function renderAnalytics(data) {
      const container = document.getElementById('analytics-content');
      
      container.innerHTML = `
        <div class="analytics-grid">
          <!-- äº‹ä»¶èšç±» -->
          <div class="analytics-card">
            <h3><span class="icon">ğŸ¯</span> äº‹ä»¶èšç±»</h3>
            <div class="cluster-list" id="cluster-list"></div>
          </div>
          
          <!-- è¶‹åŠ¿æ£€æµ‹ -->
          <div class="analytics-card">
            <h3><span class="icon">ğŸ“ˆ</span> è¶‹åŠ¿æ£€æµ‹</h3>
            <div class="trend-list" id="trend-list"></div>
          </div>
          
          <!-- å…³é”®å®ä½“ -->
          <div class="analytics-card">
            <h3><span class="icon">ğŸ‘¤</span> å…³é”®å®ä½“</h3>
            <div class="entity-grid" id="entity-grid"></div>
          </div>
          
          <!-- äº‹ä»¶æ—¶é—´çº¿ -->
          <div class="analytics-card">
            <h3><span class="icon">â±ï¸</span> äº‹ä»¶è„‰ç»œ</h3>
            <div class="timeline-list" id="timeline-list"></div>
          </div>
          
          <!-- æ¥æºåˆ†å¸ƒ - å…¨å®½ -->
          <div class="analytics-card full-width">
            <h3><span class="icon">ğŸ“Š</span> æ¥æºåˆ†å¸ƒ</h3>
            <div class="source-stats-list" id="source-stats-list"></div>
          </div>
        </div>
      `;

      // æ¸²æŸ“äº‹ä»¶èšç±»
      renderClusters(data.clusters || []);
      
      // æ¸²æŸ“è¶‹åŠ¿
      renderTrends(data.trends || []);
      
      // æ¸²æŸ“å®ä½“
      renderEntities(data.entities || []);
      
      // æ¸²æŸ“æ—¶é—´çº¿
      renderTimeline(data.timeline || []);
      
      // æ¸²æŸ“æ¥æºåˆ†å¸ƒ
      renderSourceStats(data.source_stats || {});
    }

    function renderClusters(clusters) {
      const container = document.getElementById('cluster-list');
      
      if (!clusters.length) {
        container.innerHTML = '<div class="no-data">æš‚æ— èšç±»æ•°æ®</div>';
        return;
      }

      container.innerHTML = clusters.slice(0, 5).map(cluster => `
        <div class="cluster-item">
          <div class="cluster-header">
            <div class="cluster-theme">${sanitizeTitle(cluster.theme || 'æœªçŸ¥ä¸»é¢˜')}</div>
            <span class="cluster-badge ${cluster.importance || 'medium'}">${cluster.importance === 'high' ? 'çƒ­ç‚¹' : cluster.importance === 'low' ? 'ä¸€èˆ¬' : 'å…³æ³¨'}</span>
          </div>
          <div class="cluster-desc">${sanitizeTitle(cluster.description || '')}</div>
          <div class="cluster-news">
            ${(cluster.news || []).slice(0, 4).map(n => `
              <span class="cluster-news-tag" title="${sanitizeTitle(n.title)}">${sanitizeTitle(n.title)}</span>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    function renderTrends(trends) {
      const container = document.getElementById('trend-list');
      
      if (!trends.length) {
        container.innerHTML = '<div class="no-data">æš‚æ— è¶‹åŠ¿æ•°æ®</div>';
        return;
      }

      container.innerHTML = trends.slice(0, 8).map(trend => `
        <div class="trend-item">
          <div class="trend-keyword">${sanitizeTitle(trend.keyword)}</div>
          <div class="trend-bar-wrap">
            <div class="trend-bar-fill ${trend.trend || 'stable'}" style="width: ${trend.heat || 50}%"></div>
          </div>
          <div class="trend-meta">
            <span class="trend-heat">${trend.heat || 0}</span>
            <span class="trend-type ${trend.type || 'ongoing'}">${trend.type === 'breaking' ? 'çªå‘' : trend.type === 'emerging' ? 'æ–°å…´' : 'æŒç»­'}</span>
          </div>
        </div>
      `).join('');
    }

    function renderEntities(entities) {
      const container = document.getElementById('entity-grid');
      
      if (!entities.length) {
        container.innerHTML = '<div class="no-data">æš‚æ— å®ä½“æ•°æ®</div>';
        return;
      }

      const typeLabels = {
        person: 'äººç‰©',
        org: 'ç»„ç»‡',
        location: 'åœ°ç‚¹',
        product: 'äº§å“'
      };

      container.innerHTML = entities.slice(0, 12).map(entity => `
        <div class="entity-item">
          <div class="entity-name">${sanitizeTitle(entity.name)}</div>
          <div class="entity-type">${typeLabels[entity.type] || entity.type || 'å®ä½“'}</div>
          <div class="entity-mentions">${entity.mentions || 0} æ¬¡æåŠ</div>
        </div>
      `).join('');
    }

    function renderTimeline(timeline) {
      const container = document.getElementById('timeline-list');
      
      if (!timeline.length) {
        container.innerHTML = '<div class="no-data">æš‚æ— æ—¶é—´çº¿æ•°æ®</div>';
        return;
      }

      container.innerHTML = timeline.slice(0, 6).map(item => `
        <div class="timeline-item ${item.importance || ''}">
          <div class="timeline-event">${sanitizeTitle(item.event)}</div>
          <div class="timeline-entities">
            ${(item.entities || []).slice(0, 3).map(e => `
              <span class="timeline-entity">${sanitizeTitle(e)}</span>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    function renderSourceStats(stats) {
      const container = document.getElementById('source-stats-list');
      
      const entries = Object.entries(stats);
      if (!entries.length) {
        container.innerHTML = '<div class="no-data">æš‚æ— æ¥æºæ•°æ®</div>';
        return;
      }

      const maxCount = Math.max(...entries.map(([_, count]) => count));

      container.innerHTML = entries.map(([source, count], i) => `
        <div class="source-stat-item">
          <span class="source-stat-rank">${(i + 1).toString().padStart(2, '0')}</span>
          <span class="source-stat-name">${sanitizeTitle(source)}</span>
          <div class="source-stat-bar">
            <div class="source-stat-fill" style="width: ${(count / maxCount) * 100}%"></div>
          </div>
          <span class="source-stat-count">${count}</span>
        </div>
      `).join('');
    }

    // ==================== å¡ç‰‡æ¸²æŸ“ ====================
    function createCard(source) {
      const cardTemplate = document.getElementById("source-card-template");
      const itemTemplate = document.getElementById("source-item-template");
      
      const fragment = cardTemplate.content.cloneNode(true);
      fragment.querySelector(".source-name").textContent = source.name;

      const itemsList = fragment.querySelector(".items-list");
      const heights = ['260px', '380px', '500px'];
      const randomHeight = heights[Math.floor(Math.random() * heights.length)];
      itemsList.style.maxHeight = randomHeight;

      source.items.forEach((item) => {
        const itemFragment = itemTemplate.content.cloneNode(true);
        const linkEl = itemFragment.querySelector(".item");
        
        linkEl.href = item.link;
        itemFragment.querySelector(".item-rank").textContent = item.rank < 10 ? `0${item.rank}` : item.rank;
        itemFragment.querySelector(".item-title").innerHTML = sanitizeTitle(item.title);
        
        itemsList.appendChild(itemFragment);
      });

      return fragment;
    }

    function renderPage() {
      if (!data) return;

      document.getElementById("date-input").value = data.selected_date;
      document.getElementById("display-date").textContent = formatBigDate(data.selected_date);
      document.getElementById("source-count").textContent = data.source_count;
      document.getElementById("item-count").textContent = data.item_count;

      const grid = document.getElementById("sources-grid");
      if (grid && data.sources) {
        grid.innerHTML = "";
        data.sources.forEach((source) => {
          grid.appendChild(createCard(source));
        });
      }

      flattenNews();
    }

    // ==================== Tab åˆ‡æ¢ ====================
    function switchTab(tab) {
      currentTab = tab;
      
      document.querySelectorAll('.tab-pill').forEach(pill => {
        pill.classList.toggle('active', pill.dataset.tab === tab);
      });

      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(`section-${tab}`).classList.add('active');

      if (tab === 'summary') {
        generateSummaries(currentPage);
      } else if (tab === 'analytics') {
        loadAnalytics();
      }
    }

    // ==================== äº‹ä»¶ç›‘å¬ ====================
    document.querySelectorAll('.tab-pill').forEach(pill => {
      pill.addEventListener('click', () => switchTab(pill.dataset.tab));
    });

    document.getElementById('prev-page').addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        generateSummaries(currentPage);
      }
    });

    document.getElementById('next-page').addEventListener('click', () => {
      currentPage++;
      generateSummaries(currentPage);
    });

    document.querySelector('.refresh-trigger').addEventListener('click', (e) => {
      const svg = e.currentTarget.querySelector('svg');
      svg.style.transition = 'transform 0.8s ease';
      svg.style.transform = 'rotate(360deg)';
      setTimeout(() => window.location.reload(), 800);
    });
    
    document.getElementById("date-input").addEventListener("change", (e) => {
      if(e.target.value) e.target.form.submit();
    });

    // ==================== åˆå§‹åŒ– ====================
    window.addEventListener("DOMContentLoaded", () => {
      renderPage();
      setupRefreshControl();
    });
  </script>
</body>
</html>
